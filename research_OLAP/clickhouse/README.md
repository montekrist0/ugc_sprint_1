# Тестирование Clickhouse

Для тестов использовался Postman и FLask. Коллекция тестов запускалась по 100 раз
и, таким образом, вычислялось среднее время выполнения запроса в БД.
Коллекция тестов расположена по пути `research_OLAP/clickhouse/clickhouse_tests_postman_collection_.json`.
Коллекцию можно импортировать в постман и задать запуск коллекции с любым количеством итераций.



## Порядок подготовки к тестированию
- Установить необходимые зависимости 
`pip install -r research_OLAP/clickhouse/requirements.txt`
- Сгенерировать .csv файл с тестовыми данными, содержащий 10млн записей.
Для этого запустить скрипт, расположенный по следующему пути `research_OLAP/clickhouse/data_generator.py`
- перейти в директорию `research_OLAP/clickhouse/` - тут расположен docker-compose
- выполнить команду `docker-compose up -d` - данная команда запустит
контейнер с БД ClickHouse на одной ноде и выполнит скрипт `research_OLAP/clickhouse/init_db.sql`, который
создаст тестовую базу, тестовую таблицу и скопирует в таблицу прокинутые в контейнер тестовые данные

Для того, чтобы выполнить тесты с нагрузкой (периодическая загрузка 1000 записей в базу),
требуется запустить файл `research_OLAP/clickhouse/app/src/services/db_loader.py` и после этого
снова прогнать коллекцию в постмане.

По окончании прогона запросов эти результаты можно экспортировать в .json.

## Виды тестов

- После загрузки данных происходят тесты:
  - На получение всех строк
  - На получение 1000 строк
  - На вставку 1000 строк
  - На подсчет AVG viewed_frame
  - На подсчет количества строк
- Тесты проходят как под нагрузкой(периодическая запись 1000 строк), так и без нагрузки

## Результаты тестирования

### Без нагрузки
- получение 1000 строк: 114 мс
- получение всех строк: 33 с
- вставка 1000 строк: 10 мс
- подсчет AVG viewed_frame: 12 мс
- подсчет количества строк: 8 мс

### С нагрузкой
- получение 1000 строк: 118 мс
- получение всех строк: - не проводился
- вставка 1000 строк: 11 мс
- подсчет AVG viewed_frame: 13 мс
- подсчет количества строк: 7 мс
